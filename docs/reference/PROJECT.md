# Travel Blog — Project Overview

## What This Is

A static travel blog website. Content is written in Markdown and configured in JSON;
a Node.js build step geocodes locations, converts Markdown to HTML, and renders every
page from templates. The result is a fully static site — no server-side runtime, no database.

## Architecture at a Glance

```
Source                          Build                        Output
──────                          ─────                        ──────
config/site.json          ─┐
content/index.json         ├─> scripts/build/build.js  ────>  index.html
content/trips/*/trip.json  │     + lib/*.js               map/index.html
content/trips/*/*.md  ─────┘     + templates/*.html       about/index.html
                                                          trips/*/index.html
                                                          trips/*/{loc}.html
                                                          sitemap.xml
```

- **`lib/config-paths.js`** is the single source of truth for every file path.
  All scripts import from it; never hardcode a path.
- **`lib/generate-html.js`** is the page renderer. It reads templates, substitutes
  placeholders, and writes final HTML.
- **`templates/base.html`** holds all shared CSS, the nav bar, and the footer.
  Every page inherits from it.
- **`scripts/build/build.js`** orchestrates the full pipeline: validate → geocode → render → sitemap.

## Content Model

Each trip lives in `content/trips/{tripId}/` and is self-contained:

| File | Role |
|------|------|
| `trip.json` | Trip metadata, ordered content array, cover image, map center |
| `main.md` | Trip intro page (rendered into the full-bleed hero) |
| `{location}.md` | One file per location or article |
| `images/` | Trip-specific photos |

`trip.json` content items come in two types:

- **`location`** — geographically-pinned stop. Gets a map marker, its own HTML page,
  and prev/next navigation. Requires a `place` field for geocoding.
- **`article`** — non-geographic content (e.g. a packing list). Gets its own page
  but no map marker.

## Build Pipeline

```
npm run build
  1. validate.js         — check all trip.json files for errors
  2. build.js            — geocode place names (cached in _cache/geocode.json)
  3. generate-html.js    — render every page from templates
  4. generate-sitemap.js — write sitemap.xml + robots.txt
  → outputs index.html.new (review, then promote to index.html)
```

The incremental build (`npm run build:smart`) tracks file modification times and only
re-geocodes and re-renders trips whose source files changed. Core files (templates,
libs, site config) force a full rebuild.

## Page Types

| Page | Template | URL |
|------|----------|-----|
| Homepage | `home-page.html` | `/` |
| World map | (inline in generate-html.js) | `/map/` |
| About | (inline) | `/about/` |
| Trip intro | `trip-intro-page.html` | `/trips/{slug}/` |
| Location | `trip-location-page.html` | `/trips/{slug}/{loc}.html` |

Trip intro pages feature a full-bleed hero (cover image + title overlay) injected via
the `{{PRE_MAIN}}` placeholder in `base.html`. The hero is generated by
`generate-html.js` and passed through template substitution.

## Colour & Design

The site uses an amber colour scheme:

- Primary accent: `#f59e0b`
- Gradient buttons: `linear-gradient(to right, #f59e0b, #ea580c)`
- Map markers: amber SVG teardrop via `L.divIcon`
- Route polylines: `#f59e0b`

All CSS lives in `templates/base.html`.

## npm Scripts

| Script | What it does |
|--------|--------------|
| `npm run build` | Full build: validate → geocode → render |
| `npm run build:smart` | Incremental: only rebuild changed trips |
| `npm run dev` | Smart build + start local server |
| `npm run serve` | Start local server (no build) |
| `npm run watch` | Auto-rebuild on content changes (nodemon) |
| `npm run validate` | Check trip configs for errors |
| `npm run add` | Interactive CLI to scaffold a new trip |
| `npm test` | Navigation, filter, and map smoke tests |
| `npm run deploy-check` | Pre-deploy file verification |
| `npm run sync-docs` | Compare docs against code, report drift |

## Deployment

CI runs on every push to `main` via `.github/workflows/deploy.yml`:

1. `npm run build` — auto-promotes `index.html.new` → `index.html`
2. `npm test` — navigation, filter, and map smoke tests
3. Copy output files into `deploy/`
4. Upload via GitHub Pages API

For manual or alternative hosts see `docs/deployment/DEPLOYMENT.md`.

## Adding a Trip

The fastest path is the interactive scaffolder:

```bash
npm run add
```

Or manually:

1. Create `content/trips/{id}/trip.json` (see [FILES.md](FILES.md) for the full schema)
2. Create `content/trips/{id}/main.md`
3. Create one `.md` per location
4. Add the trip ID to `content/index.json`
5. `npm run build`
