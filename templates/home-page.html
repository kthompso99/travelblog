<div id="home-view">
    <div class="hero">
        <h1>{{SITE_TITLE}}</h1>
        <p>{{SITE_DESCRIPTION}}</p>
    </div>
    {{SITE_INTRO}}

    <h2 class="section-title">Explore Our Adventures</h2>
    {{FILTER_BAR}}
    <div class="destination-grid" id="destination-grid">
        {{TRIP_GRID}}
    </div>
    <p class="no-results" id="no-results">No trips match your search. Try broadening your filters.</p>
</div>

<script>
    // SPA enhancement for homepage
    let config = null;
    const tripContentCache = {};
    let map = null;
    let markers = [];

    const APP_BASE = '{{APP_BASE}}';
    const BASE_PATH = './';

    async function loadConfig() {
        try {
            const response = await fetch('./config.built.json');
            config = await response.json();
        } catch (error) {
            console.log('Config not loaded, static mode only');
        }
    }

    // Load trip with SPA navigation
    async function loadTrip(id, pushState = true) {
        if (!config) {
            // Fallback to static navigation
            window.location.href = `./trips/${id}/`;
            return;
        }

        const tripMetadata = config.trips.find(d => d.id === id);
        if (!tripMetadata) {
            window.location.href = `./trips/${id}/`;
            return;
        }

        if (pushState) {
            const tripUrl = `./trips/${id}/`;
            history.pushState({ view: 'trip', id: id }, tripMetadata.title, tripUrl);
        }

        // Check cache first
        if (tripContentCache[id]) {
            navigateToTrip(id);
            return;
        }

        // For now, do full page navigation to static page
        // Full SPA implementation can be added later
        window.location.href = `./trips/${id}/`;
    }

    function navigateToTrip(id) {
        window.location.href = `./trips/${id}/`;
    }

    // Load config on page load (for future SPA enhancements)
    document.addEventListener('DOMContentLoaded', () => {
        loadConfig();

        // No click interception needed - let the browser follow href attributes naturally
        // This ensures correct relative path navigation
    });
</script>

<script>
(function() {
    var activeContinent = 'all';
    var activeYear      = 'all';

    function applyFilters() {
        var query = document.getElementById('trip-search').value.toLowerCase();
        var cards = document.querySelectorAll('.destination-card');
        var visibleCount = 0;

        cards.forEach(function(card) {
            var title     = (card.dataset.title     || '').toLowerCase();
            var country   = (card.dataset.country   || '').toLowerCase();
            var countries = (card.dataset.countries || '').toLowerCase();
            var continent = (card.dataset.continent || '').toLowerCase();
            var year      = card.dataset.year || '';

            var matchesSearch    = !query || title.includes(query) || country.includes(query) || countries.includes(query) || continent.includes(query);
            var matchesContinent = activeContinent === 'all' || continent === activeContinent.toLowerCase();
            var matchesYear      = activeYear === 'all' || year === activeYear;

            var visible = matchesSearch && matchesContinent && matchesYear;
            card.style.display = visible ? '' : 'none';
            if (visible) visibleCount++;
        });

        document.getElementById('no-results').style.display = visibleCount === 0 ? 'block' : 'none';
    }

    // No DOMContentLoaded needed â€” this script is after the cards in <body>,
    // so the elements it references already exist.
    var searchInput = document.getElementById('trip-search');
    if (searchInput) {
        searchInput.addEventListener('input', applyFilters);
    }

    // Continent pill click handler
    document.querySelectorAll('.filter-pill').forEach(function(pill) {
        pill.addEventListener('click', function() {
            this.closest('.filter-pills').querySelectorAll('.filter-pill').forEach(function(p) {
                p.classList.remove('active');
            });
            this.classList.add('active');
            activeContinent = this.dataset.value;
            applyFilters();
        });
    });

    // Year dropdown handler
    var yearDropdown = document.getElementById('year-filter');
    if (yearDropdown) {
        yearDropdown.addEventListener('change', function() {
            activeYear = this.value;
            applyFilters();
        });
    }
})();
</script>
