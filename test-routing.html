<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Travel Blog - Routing Test Suite</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 { color: #667eea; }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-case {
            padding: 10px;
            margin: 10px 0;
            border-left: 4px solid #ddd;
            background: #f9f9f9;
        }
        .test-case.pass {
            border-left-color: #4caf50;
            background: #f1f8f4;
        }
        .test-case.fail {
            border-left-color: #f44336;
            background: #fff1f0;
        }
        .test-case h3 {
            margin: 0 0 10px 0;
            font-size: 16px;
        }
        .test-status {
            font-weight: bold;
            margin-right: 10px;
        }
        .pass .test-status { color: #4caf50; }
        .fail .test-status { color: #f44336; }
        .test-details {
            font-family: monospace;
            font-size: 12px;
            margin: 5px 0;
            padding: 5px;
            background: #f0f0f0;
            border-radius: 3px;
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 10px 10px 0;
        }
        button:hover {
            background: #764ba2;
        }
        #summary {
            font-size: 20px;
            font-weight: bold;
            margin: 20px 0;
            padding: 15px;
            border-radius: 8px;
        }
        #summary.all-pass {
            background: #4caf50;
            color: white;
        }
        #summary.some-fail {
            background: #f44336;
            color: white;
        }
    </style>
</head>
<body>
    <h1>üß™ Travel Blog - Routing Test Suite</h1>

    <div class="test-section">
        <h2>Instructions</h2>
        <p>This test suite validates that URL routing works correctly both locally and on GitHub Pages.</p>
        <button onclick="runAllTests()">‚ñ∂Ô∏è Run All Tests</button>
        <button onclick="location.href='/'">üè† Back to Site</button>
    </div>

    <div id="summary" style="display: none;"></div>

    <div id="results"></div>

    <script>
        const tests = [];
        const results = [];

        function addTest(name, testFn) {
            tests.push({ name, testFn });
        }

        function assert(condition, message) {
            if (!condition) {
                throw new Error(message);
            }
        }

        function assertEquals(actual, expected, message) {
            if (actual !== expected) {
                throw new Error(`${message}\nExpected: ${expected}\nActual: ${actual}`);
            }
        }

        function assertContains(text, substring, message) {
            if (!text.includes(substring)) {
                throw new Error(`${message}\nExpected "${text}" to contain "${substring}"`);
            }
        }

        // Test 1: APP_BASE detection
        addTest('APP_BASE detection', async () => {
            const path = window.location.pathname;
            const segments = path.split('/').filter(p => p);
            let expectedBase;

            if (segments.length > 0 && !segments[0].includes('.') && segments[0] !== 'test-routing.html') {
                expectedBase = '/' + segments[0] + '/';
            } else {
                expectedBase = '/';
            }

            // This would need access to the actual APP_BASE variable
            // For now, just document the expected behavior
            return {
                status: 'info',
                message: `Expected APP_BASE for path "${path}" should be: ${expectedBase}`
            };
        });

        // Test 2: Config file URL construction
        addTest('Config file URLs', async () => {
            const testCases = [
                { path: '/', expected: '/config.built.json' },
                { path: '/travelblog/', expected: '/travelblog/config.built.json' },
                { path: '/travelblog/destination/greece', expected: '/travelblog/config.built.json' }
            ];

            const errors = [];
            for (const tc of testCases) {
                const segments = tc.path.split('/').filter(p => p);
                let appBase;
                if (segments.length > 0 && !segments[0].includes('.')) {
                    appBase = '/' + segments[0] + '/';
                } else {
                    appBase = '/';
                }
                const configUrl = appBase + 'config.built.json';

                if (configUrl !== tc.expected) {
                    errors.push(`Path "${tc.path}" -> "${configUrl}" (expected "${tc.expected}")`);
                }
            }

            if (errors.length > 0) {
                throw new Error('Config URL construction failed:\n' + errors.join('\n'));
            }
        });

        // Test 3: Navigation URL construction
        addTest('Navigation URLs', async () => {
            const path = window.location.pathname;
            const segments = path.split('/').filter(p => p);
            let appBase;

            if (segments.length > 0 && !segments[0].includes('.') && segments[0] !== 'test-routing.html') {
                appBase = '/' + segments[0] + '/';
            } else {
                appBase = '/';
            }

            const testCases = [
                { name: 'Home', url: appBase },
                { name: 'Map', url: `${appBase}map` },
                { name: 'About', url: `${appBase}about` },
                { name: 'Destination', url: `${appBase}destination/southernafrica` }
            ];

            return {
                status: 'info',
                message: `Navigation URLs:\n${testCases.map(tc => `${tc.name}: ${tc.url}`).join('\n')}`
            };
        });

        // Test 4: Fetch config file
        addTest('Fetch config.built.json', async () => {
            const path = window.location.pathname;
            const segments = path.split('/').filter(p => p);
            let appBase;

            if (segments.length > 0 && !segments[0].includes('.') && segments[0] !== 'test-routing.html') {
                appBase = '/' + segments[0] + '/';
            } else {
                appBase = '/';
            }

            const configUrl = appBase + 'config.built.json';
            const response = await fetch(configUrl);

            assertEquals(response.status, 200, 'Config file should return 200');

            const data = await response.json();
            assert(data.site, 'Config should have site object');
            assert(data.destinations, 'Config should have destinations array');
            assert(data.destinations.length > 0, 'Should have at least one destination');

            // Check for real destinations (not demo)
            const ids = data.destinations.map(d => d.id);
            const hasRealData = ids.includes('greece') || ids.includes('southernafrica');
            assert(hasRealData, 'Should have real destinations (not demo data)');
        });

        // Test 5: Path routing logic
        addTest('Path routing recognition', async () => {
            const testCases = [
                { path: '/', shouldBeHome: true },
                { path: '/index.html', shouldBeHome: true },
                { path: '/travelblog/', shouldBeHome: true },
                { path: '/travelblog/index.html', shouldBeHome: true },
                { path: '/travelblog', shouldBeHome: true },
                { path: '/map', shouldBeHome: false },
                { path: '/travelblog/map', shouldBeHome: false },
                { path: '/destination/greece', shouldBeHome: false },
                { path: '/travelblog/destination/greece', shouldBeHome: false }
            ];

            const errors = [];
            for (const tc of testCases) {
                const cleanPath = tc.path.replace(/\/$/, '');
                const isHome = cleanPath === '' || cleanPath === '/' || cleanPath === '/index.html' ||
                              cleanPath === '/travelblog' || cleanPath === '/travelblog/index.html';

                if (isHome !== tc.shouldBeHome) {
                    errors.push(`Path "${tc.path}" recognized as ${isHome ? 'home' : 'not home'} (expected ${tc.shouldBeHome ? 'home' : 'not home'})`);
                }
            }

            if (errors.length > 0) {
                throw new Error('Path routing logic failed:\n' + errors.join('\n'));
            }
        });

        async function runAllTests() {
            results.length = 0;
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '';

            for (const test of tests) {
                const resultDiv = document.createElement('div');
                resultDiv.className = 'test-case';
                resultDiv.innerHTML = `<h3><span class="test-status">‚è≥ RUNNING</span> ${test.name}</h3>`;
                resultsDiv.appendChild(resultDiv);

                try {
                    const result = await test.testFn();
                    if (result && result.status === 'info') {
                        resultDiv.className = 'test-case pass';
                        resultDiv.innerHTML = `
                            <h3><span class="test-status">‚ÑπÔ∏è INFO</span> ${test.name}</h3>
                            <div class="test-details">${result.message.replace(/\n/g, '<br>')}</div>
                        `;
                        results.push({ name: test.name, pass: true });
                    } else {
                        resultDiv.className = 'test-case pass';
                        resultDiv.innerHTML = `<h3><span class="test-status">‚úÖ PASS</span> ${test.name}</h3>`;
                        results.push({ name: test.name, pass: true });
                    }
                } catch (error) {
                    resultDiv.className = 'test-case fail';
                    resultDiv.innerHTML = `
                        <h3><span class="test-status">‚ùå FAIL</span> ${test.name}</h3>
                        <div class="test-details">${error.message.replace(/\n/g, '<br>')}</div>
                    `;
                    results.push({ name: test.name, pass: false, error: error.message });
                }
            }

            showSummary();
        }

        function showSummary() {
            const summaryDiv = document.getElementById('summary');
            const passed = results.filter(r => r.pass).length;
            const failed = results.filter(r => !r.pass).length;
            const total = results.length;

            summaryDiv.style.display = 'block';
            summaryDiv.className = failed === 0 ? 'all-pass' : 'some-fail';
            summaryDiv.textContent = `Tests Complete: ${passed}/${total} passed${failed > 0 ? `, ${failed} failed` : ''}`;

            if (failed === 0) {
                summaryDiv.textContent += ' üéâ';
            }
        }

        // Auto-run tests on load
        window.addEventListener('load', () => {
            setTimeout(runAllTests, 500);
        });
    </script>
</body>
</html>
